import numpy as np
import matplotlib.pyplot as plt

# ----------------------------------------------------------
# Реалистичные параметры двухступенчатой ракеты
# ----------------------------------------------------------
m_c1 = 1800        # конструкционная масса 1-й ступени
m_c2 = 900         # конструкционная масса 2-й ступени
m_payload = 1200   # полезная нагрузка

fuel_total = 5000  # общий запас топлива (который распределяем)

ve1 = 3000         # скорость истечения газов первой ступени
ve2 = 4100         # скорость истечения газов второй ступени


# ----------------------------------------------------------
# Функция итоговой скорости ракеты
# ----------------------------------------------------------
def rocket_velocity(alpha):
    """
    alpha — доля топлива, приходящаяся на 1-ю ступень
    возвращает итоговую скорость ракеты
    """

    m_t1 = fuel_total * alpha
    m_t2 = fuel_total * (1 - alpha)

    # Нельзя, чтобы топлива не было
    if m_t1 <= 0 or m_t2 <= 0:
        return np.nan

    # Массы на этапах
    m0 = m_c1 + m_t1 + m_c2 + m_t2 + m_payload
    m1 = m_c2 + m_t2 + m_payload
    m2 = m_payload

    # ΔV по ступеням
    dV1 = ve1 * np.log(m0 / m1)
    dV2 = ve2 * np.log(m1 / m2)

    return dV1 + dV2


# ----------------------------------------------------------
# Диапазон значений α
# ----------------------------------------------------------
alphas = np.linspace(0.05, 0.95, 100)
velocities = np.array([rocket_velocity(a) for a in alphas])

# Оптимум
idx = np.nanargmax(velocities)
alpha_opt = alphas[idx]
v_opt = velocities[idx]

print(f"Оптимальная доля топлива: {alpha_opt:.3f}")
print(f"Максимальная скорость: {v_opt:.1f} м/с")


# ----------------------------------------------------------
# График 1 — влияние топлива первой ступени
# ----------------------------------------------------------
plt.figure(figsize=(9, 5))
plt.plot(alphas, velocities, linewidth=2)
plt.scatter(alpha_opt, v_opt, color='red')

plt.text(alpha_opt, v_opt,
         f"  α = {alpha_opt:.2f}\n  V = {v_opt:.1f} м/с",
         fontsize=10, va='bottom')

plt.title("Зависимость конечной скорости от доли топлива в первой ступени")
plt.xlabel("Доля топлива в 1-й ступени, α")
plt.ylabel("Конечная скорость, м/с")
plt.grid(True)
plt.tight_layout()
plt.show()


# ----------------------------------------------------------
# График 2 — зависимость от топлива второй ступени (β = 1−α)
# ----------------------------------------------------------
betas = 1 - alphas   # доля топлива во второй ступени

plt.figure(figsize=(9, 5))
plt.plot(betas, velocities, linewidth=2)

plt.title("Зависимость конечной скорости от доли топлива во второй ступени")
plt.xlabel("Доля топлива во 2-й ступени, β")
plt.ylabel("Конечная скорость, м/с")
plt.grid(True)
plt.tight_layout()
plt.show()
